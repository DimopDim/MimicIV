{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Σε αυτό το κομμάτι του κώδικα καταμετρώ και ελέγχω και διαχωρίζω την ηλικία των ασθενών"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'\\nΣτης στήλες που εμφανίζονται το anchor_age εμπεριέχει\\nτην ηλικιακή αναφορά του ασθενούς. Το anchor_year δηλώνει\\nμία μελλοντική ημερομηνία και το anchor_year_group\\nσυνδυαστικά με τα προηγούμενα παράγει την ηλικία του ασθενούς.\\nΗ μέθοδος υπολογισμού της ηλικίας του ασθενούς δημιουργεί\\nαρχικά μία σύγχυση αλλά μετά από τον κώδικα που παράγω εδώ\\nδιαπιστώνετε ότι το anchor_year όπου δηλώνει την ηλικία του\\nασθενή είναι πάντα προγενέστερο σε σχέση με τις αποτυπώσεις\\nπου βρίσκονται στις εισαγωγές. \\n'"
      ]
     },
     "execution_count": 1,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "Στης στήλες που εμφανίζονται το anchor_age εμπεριέχει\n",
    "την ηλικιακή αναφορά του ασθενούς. Το anchor_year δηλώνει\n",
    "μία μελλοντική ημερομηνία και το anchor_year_group\n",
    "συνδυαστικά με τα προηγούμενα παράγει την ηλικία του ασθενούς.\n",
    "Η μέθοδος υπολογισμού της ηλικίας του ασθενούς δημιουργεί\n",
    "αρχικά μία σύγχυση αλλά μετά από τον κώδικα που παράγω εδώ\n",
    "διαπιστώνετε ότι το anchor_year όπου δηλώνει την ηλικία του\n",
    "ασθενή είναι πάντα προγενέστερο σε σχέση με τις αποτυπώσεις\n",
    "που βρίσκονται στις εισαγωγές. \n",
    "\"\"\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_patients = pd.read_csv('D:\\Thesis\\mimic-iv-1.0\\core\\patients.csv.gz', usecols = ['subject_id', 'anchor_year'])\n",
    "\n",
    "df_admissions = pd.read_csv('D:\\Thesis\\mimic-iv-1.0\\core\\Admissions.csv.gz', usecols = ['subject_id','admittime'])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Σύνολο Ασθενών"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>subject_id</th>\n",
       "      <th>anchor_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>10000048</td>\n",
       "      <td>2126</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>10002723</td>\n",
       "      <td>2128</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>10003939</td>\n",
       "      <td>2184</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>10004222</td>\n",
       "      <td>2161</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>10005325</td>\n",
       "      <td>2154</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>382273</th>\n",
       "      <td>19998203</td>\n",
       "      <td>2132</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>382274</th>\n",
       "      <td>19998350</td>\n",
       "      <td>2127</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>382275</th>\n",
       "      <td>19999068</td>\n",
       "      <td>2161</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>382276</th>\n",
       "      <td>19999270</td>\n",
       "      <td>2184</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>382277</th>\n",
       "      <td>19999298</td>\n",
       "      <td>2177</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>382278 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        subject_id  anchor_year\n",
       "0         10000048         2126\n",
       "1         10002723         2128\n",
       "2         10003939         2184\n",
       "3         10004222         2161\n",
       "4         10005325         2154\n",
       "...            ...          ...\n",
       "382273    19998203         2132\n",
       "382274    19998350         2127\n",
       "382275    19999068         2161\n",
       "382276    19999270         2184\n",
       "382277    19999298         2177\n",
       "\n",
       "[382278 rows x 2 columns]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "Πίνακας συνόλου ασθενών που περιλαμβάνονται\n",
    "στην MIMIC-IV (382.278 ασθενείς)\n",
    "\"\"\"\n",
    "df_patients"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "\"\"\"\n",
    "Αποθηκεύω σε μια νέα μεταβλητή τα αποτελέσματα\n",
    "του συνόλου των ασθενών απαλαγμένα από διπλοεγγραφές.\n",
    "Απλά ελέγχω αν υπάρχουν διπλοεγγραφές, πράγμα που δεν\n",
    "ισχύει και ήταν αναμενόμενο, αλλά για να είμαι σίγουρος\n",
    "έκανα τον έλεγχο.\n",
    "\"\"\"\n",
    "rslt_df = df_patients.drop_duplicates(subset=['subject_id'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>subject_id</th>\n",
       "      <th>anchor_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>247884</th>\n",
       "      <td>10001180</td>\n",
       "      <td>2192</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        subject_id  anchor_year\n",
       "247884    10001180         2192"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\"\n",
    "Στης στήλες που εμφανίζονται το anchor_age εμπεριέχει\n",
    "την ηλικία του ασθενούς. Το anchor_year δηλώνει την\n",
    "μελλοντική ημερομηνία που έχει αποτυπωθεί και συνδιαστικά\n",
    "με το anchor_year_group μπορούμε να υπολογίσουμε την ηλικία\n",
    "του ασθενούς. Ο τρόπος αυτός της αποτύπωσης δημιουργεί μία\n",
    "αρχικη σύγχηση οπότε έκανα δειγματολοιπτικούς\n",
    "\"\"\"\n",
    "rslt_df.loc[rslt_df['subject_id'] == 10001180 ]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_admissions = df_admissions.sort_values(by=[\"subject_id\", \"admittime\"], ascending=[True, True])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>subject_id</th>\n",
       "      <th>admittime</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>266356</th>\n",
       "      <td>10000019</td>\n",
       "      <td>2129-05-21 19:16:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>434288</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-05-06 22:23:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>446284</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-06-26 18:27:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>427806</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-07-23 12:35:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>453525</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-08-05 23:44:00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        subject_id            admittime\n",
       "266356    10000019  2129-05-21 19:16:00\n",
       "434288    10000032  2180-05-06 22:23:00\n",
       "446284    10000032  2180-06-26 18:27:00\n",
       "427806    10000032  2180-07-23 12:35:00\n",
       "453525    10000032  2180-08-05 23:44:00"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_admissions.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>subject_id</th>\n",
       "      <th>admittime</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>346045</th>\n",
       "      <td>10001180</td>\n",
       "      <td>2192-05-23 04:58:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>362158</th>\n",
       "      <td>10001180</td>\n",
       "      <td>2193-11-16 20:20:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>346696</th>\n",
       "      <td>10001180</td>\n",
       "      <td>2197-06-06 08:12:00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        subject_id            admittime\n",
       "346045    10001180  2192-05-23 04:58:00\n",
       "362158    10001180  2193-11-16 20:20:00\n",
       "346696    10001180  2197-06-06 08:12:00"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_admissions.loc[df_admissions['subject_id'] == 10001180]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Μετατροπή της στήλης charttime από object σε datetime\n",
    "\n",
    "df_admissions['admittime']= pd.to_datetime(df_admissions['admittime'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>subject_id</th>\n",
       "      <th>admittime</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>266356</th>\n",
       "      <td>10000019</td>\n",
       "      <td>2129-05-21 19:16:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>434288</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-05-06 22:23:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>446284</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-06-26 18:27:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>427806</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-07-23 12:35:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>453525</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-08-05 23:44:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>188744</th>\n",
       "      <td>19999828</td>\n",
       "      <td>2147-07-18 16:23:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>194111</th>\n",
       "      <td>19999828</td>\n",
       "      <td>2149-01-08 16:44:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>383585</th>\n",
       "      <td>19999840</td>\n",
       "      <td>2164-07-25 00:27:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>374265</th>\n",
       "      <td>19999840</td>\n",
       "      <td>2164-09-10 13:47:00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>346882</th>\n",
       "      <td>19999987</td>\n",
       "      <td>2145-11-02 21:38:00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>523740 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        subject_id           admittime\n",
       "266356    10000019 2129-05-21 19:16:00\n",
       "434288    10000032 2180-05-06 22:23:00\n",
       "446284    10000032 2180-06-26 18:27:00\n",
       "427806    10000032 2180-07-23 12:35:00\n",
       "453525    10000032 2180-08-05 23:44:00\n",
       "...            ...                 ...\n",
       "188744    19999828 2147-07-18 16:23:00\n",
       "194111    19999828 2149-01-08 16:44:00\n",
       "383585    19999840 2164-07-25 00:27:00\n",
       "374265    19999840 2164-09-10 13:47:00\n",
       "346882    19999987 2145-11-02 21:38:00\n",
       "\n",
       "[523740 rows x 2 columns]"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_admissions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Διαχωρισμός σε δυο καινούργιες στήλες της ημερομηνίας και ώρας\n",
    "df_admissions['date'] = pd.to_datetime(df_admissions['admittime']).dt.date\n",
    "df_admissions['time'] = pd.to_datetime(df_admissions['admittime']).dt.time"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_admissions['year'] = pd.DatetimeIndex(df_admissions['date']).year"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>subject_id</th>\n",
       "      <th>admittime</th>\n",
       "      <th>date</th>\n",
       "      <th>time</th>\n",
       "      <th>year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>266356</th>\n",
       "      <td>10000019</td>\n",
       "      <td>2129-05-21 19:16:00</td>\n",
       "      <td>2129-05-21</td>\n",
       "      <td>19:16:00</td>\n",
       "      <td>2129</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>434288</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-05-06 22:23:00</td>\n",
       "      <td>2180-05-06</td>\n",
       "      <td>22:23:00</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>446284</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-06-26 18:27:00</td>\n",
       "      <td>2180-06-26</td>\n",
       "      <td>18:27:00</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>427806</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-07-23 12:35:00</td>\n",
       "      <td>2180-07-23</td>\n",
       "      <td>12:35:00</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>453525</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180-08-05 23:44:00</td>\n",
       "      <td>2180-08-05</td>\n",
       "      <td>23:44:00</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>188744</th>\n",
       "      <td>19999828</td>\n",
       "      <td>2147-07-18 16:23:00</td>\n",
       "      <td>2147-07-18</td>\n",
       "      <td>16:23:00</td>\n",
       "      <td>2147</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>194111</th>\n",
       "      <td>19999828</td>\n",
       "      <td>2149-01-08 16:44:00</td>\n",
       "      <td>2149-01-08</td>\n",
       "      <td>16:44:00</td>\n",
       "      <td>2149</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>383585</th>\n",
       "      <td>19999840</td>\n",
       "      <td>2164-07-25 00:27:00</td>\n",
       "      <td>2164-07-25</td>\n",
       "      <td>00:27:00</td>\n",
       "      <td>2164</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>374265</th>\n",
       "      <td>19999840</td>\n",
       "      <td>2164-09-10 13:47:00</td>\n",
       "      <td>2164-09-10</td>\n",
       "      <td>13:47:00</td>\n",
       "      <td>2164</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>346882</th>\n",
       "      <td>19999987</td>\n",
       "      <td>2145-11-02 21:38:00</td>\n",
       "      <td>2145-11-02</td>\n",
       "      <td>21:38:00</td>\n",
       "      <td>2145</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>523740 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        subject_id           admittime        date      time  year\n",
       "266356    10000019 2129-05-21 19:16:00  2129-05-21  19:16:00  2129\n",
       "434288    10000032 2180-05-06 22:23:00  2180-05-06  22:23:00  2180\n",
       "446284    10000032 2180-06-26 18:27:00  2180-06-26  18:27:00  2180\n",
       "427806    10000032 2180-07-23 12:35:00  2180-07-23  12:35:00  2180\n",
       "453525    10000032 2180-08-05 23:44:00  2180-08-05  23:44:00  2180\n",
       "...            ...                 ...         ...       ...   ...\n",
       "188744    19999828 2147-07-18 16:23:00  2147-07-18  16:23:00  2147\n",
       "194111    19999828 2149-01-08 16:44:00  2149-01-08  16:44:00  2149\n",
       "383585    19999840 2164-07-25 00:27:00  2164-07-25  00:27:00  2164\n",
       "374265    19999840 2164-09-10 13:47:00  2164-09-10  13:47:00  2164\n",
       "346882    19999987 2145-11-02 21:38:00  2145-11-02  21:38:00  2145\n",
       "\n",
       "[523740 rows x 5 columns]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_admissions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_admissions.drop('admittime', inplace=True, axis=1)\n",
    "df_admissions.drop('date', inplace=True, axis=1)\n",
    "df_admissions.drop('time', inplace=True, axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>subject_id</th>\n",
       "      <th>year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>266356</th>\n",
       "      <td>10000019</td>\n",
       "      <td>2129</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>434288</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>446284</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>427806</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>453525</th>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>188744</th>\n",
       "      <td>19999828</td>\n",
       "      <td>2147</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>194111</th>\n",
       "      <td>19999828</td>\n",
       "      <td>2149</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>383585</th>\n",
       "      <td>19999840</td>\n",
       "      <td>2164</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>374265</th>\n",
       "      <td>19999840</td>\n",
       "      <td>2164</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>346882</th>\n",
       "      <td>19999987</td>\n",
       "      <td>2145</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>523740 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        subject_id  year\n",
       "266356    10000019  2129\n",
       "434288    10000032  2180\n",
       "446284    10000032  2180\n",
       "427806    10000032  2180\n",
       "453525    10000032  2180\n",
       "...            ...   ...\n",
       "188744    19999828  2147\n",
       "194111    19999828  2149\n",
       "383585    19999840  2164\n",
       "374265    19999840  2164\n",
       "346882    19999987  2145\n",
       "\n",
       "[523740 rows x 2 columns]"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_admissions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "\"\"\"\n",
    "Δημιουργώ την στήλη concat και στον πίνακα\n",
    "που περιλαμβάνει τις μετρήσεις για να είναι\n",
    "το κοινό σημείο ανάμεσα στους δυο πίνακες.\n",
    "\"\"\"\n",
    "df_admissions[\"concat\"] = (df_admissions[\"subject_id\"].astype(str)\n",
    "                         + df_admissions[\"year\"].astype(str))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "\"\"\"\n",
    "Δημιουργώ την στήλη concat και στον πίνακα\n",
    "που περιλαμβάνει τις μετρήσεις για να είναι\n",
    "το κοινό σημείο ανάμεσα στους δυο πίνακες.\n",
    "\"\"\"\n",
    "df_patients[\"concat\"] = (df_patients[\"subject_id\"].astype(str)\n",
    "                         + df_patients[\"anchor_year\"].astype(str))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_admissions = df_admissions[['concat', 'subject_id', 'year']]\n",
    "df_patients = df_patients[['concat', 'subject_id', 'anchor_year']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>concat</th>\n",
       "      <th>subject_id</th>\n",
       "      <th>year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>266356</th>\n",
       "      <td>100000192129</td>\n",
       "      <td>10000019</td>\n",
       "      <td>2129</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>434288</th>\n",
       "      <td>100000322180</td>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>446284</th>\n",
       "      <td>100000322180</td>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>427806</th>\n",
       "      <td>100000322180</td>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>453525</th>\n",
       "      <td>100000322180</td>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>188744</th>\n",
       "      <td>199998282147</td>\n",
       "      <td>19999828</td>\n",
       "      <td>2147</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>194111</th>\n",
       "      <td>199998282149</td>\n",
       "      <td>19999828</td>\n",
       "      <td>2149</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>383585</th>\n",
       "      <td>199998402164</td>\n",
       "      <td>19999840</td>\n",
       "      <td>2164</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>374265</th>\n",
       "      <td>199998402164</td>\n",
       "      <td>19999840</td>\n",
       "      <td>2164</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>346882</th>\n",
       "      <td>199999872145</td>\n",
       "      <td>19999987</td>\n",
       "      <td>2145</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>523740 rows × 3 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "              concat  subject_id  year\n",
       "266356  100000192129    10000019  2129\n",
       "434288  100000322180    10000032  2180\n",
       "446284  100000322180    10000032  2180\n",
       "427806  100000322180    10000032  2180\n",
       "453525  100000322180    10000032  2180\n",
       "...              ...         ...   ...\n",
       "188744  199998282147    19999828  2147\n",
       "194111  199998282149    19999828  2149\n",
       "383585  199998402164    19999840  2164\n",
       "374265  199998402164    19999840  2164\n",
       "346882  199999872145    19999987  2145\n",
       "\n",
       "[523740 rows x 3 columns]"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_admissions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [],
   "source": [
    "#Ελέγχω αν μετά την συγχώνευση υπάρχουν διπλές ίδιες στήλες\n",
    "\n",
    "rslt=pd.merge(df_admissions, df_patients, on=['concat'],\n",
    "              how=\"inner\", suffixes=('', '_delme'))\n",
    "\n",
    "# Και αν υπάρχουν τις αφαιρώ\n",
    "rslt = rslt[[c for c in rslt.columns if not c.endswith('_delme')]]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>concat</th>\n",
       "      <th>subject_id</th>\n",
       "      <th>year</th>\n",
       "      <th>anchor_year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>100000192129</td>\n",
       "      <td>10000019</td>\n",
       "      <td>2129</td>\n",
       "      <td>2129</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>100000322180</td>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>100000322180</td>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>100000322180</td>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>100000322180</td>\n",
       "      <td>10000032</td>\n",
       "      <td>2180</td>\n",
       "      <td>2180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297918</th>\n",
       "      <td>199997842119</td>\n",
       "      <td>19999784</td>\n",
       "      <td>2119</td>\n",
       "      <td>2119</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297919</th>\n",
       "      <td>199998282147</td>\n",
       "      <td>19999828</td>\n",
       "      <td>2147</td>\n",
       "      <td>2147</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297920</th>\n",
       "      <td>199998402164</td>\n",
       "      <td>19999840</td>\n",
       "      <td>2164</td>\n",
       "      <td>2164</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297921</th>\n",
       "      <td>199998402164</td>\n",
       "      <td>19999840</td>\n",
       "      <td>2164</td>\n",
       "      <td>2164</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297922</th>\n",
       "      <td>199999872145</td>\n",
       "      <td>19999987</td>\n",
       "      <td>2145</td>\n",
       "      <td>2145</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>297923 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "              concat  subject_id  year  anchor_year\n",
       "0       100000192129    10000019  2129         2129\n",
       "1       100000322180    10000032  2180         2180\n",
       "2       100000322180    10000032  2180         2180\n",
       "3       100000322180    10000032  2180         2180\n",
       "4       100000322180    10000032  2180         2180\n",
       "...              ...         ...   ...          ...\n",
       "297918  199997842119    19999784  2119         2119\n",
       "297919  199998282147    19999828  2147         2147\n",
       "297920  199998402164    19999840  2164         2164\n",
       "297921  199998402164    19999840  2164         2164\n",
       "297922  199999872145    19999987  2145         2145\n",
       "\n",
       "[297923 rows x 4 columns]"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "rslt"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [],
   "source": [
    "rslt['check'] = np.where((rslt['year'] >= rslt['anchor_year']), True, False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[True]"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "list(set(rslt['check']))"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
